**Квартили: теория и методы расчета**

---

### **1. Что такое квартили?**
Квартили — это значения, которые делят упорядоченный набор данных на **четыре равные части** по количеству наблюдений. Они помогают анализировать распределение данных, выявлять медиану, разброс и асимметрию. Всего выделяют три квартиля:
- **Q1 (первый квартиль)** — значение, ниже которого находится 25% данных.
- **Q2 (второй квартиль)** — это **медиана**, разделяющая данные на две равные половины (50% данных ниже этого значения).
- **Q3 (третий квартиль)** — значение, ниже которого находится 75% данных.

---

### **2. Как находить квартили?**
#### **Шаг 1: Упорядочить данные**
Данные должны быть расположены в порядке возрастания.  
Пример:  
Данные: `[3, 7, 8, 5, 12, 14, 21, 13, 18]`  
Упорядоченные: `[3, 5, 7, 8, 12, 13, 14, 18, 21]`.

#### **Шаг 2: Найти позиции квартилей**
Используются формулы:
- Для **Q1**: позиция = $\frac{n+1}{4}$,
- Для **Q3**: позиция = $\frac{3(n+1)}{4}$,  
где $n$ — количество наблюдений.

Если позиция не целая, проводится **линейная интерполяция** между ближайшими значениями.

#### **Пример 1: Нечетное количество данных**
Данные: `[3, 5, 7, 8, 12, 13, 14, 18, 21]` ($n = 9$):
- **Q1**: $\frac{9+1}{4} = 2.5$ → среднее между 2-м и 3-м элементом: $\frac{5 + 7}{2} = 6$.
- **Q2 (медиана)**: 5-й элемент → 12.
- **Q3**: $\frac{3(9+1)}{4} = 7.5$ → среднее между 7-м и 8-м элементом: $\frac{14 + 18}{2} = 16$.

#### **Пример 2: Четное количество данных**
Данные: `[1, 2, 3, 4, 5, 6]` ($n = 6$):
- **Q1**: $\frac{6+1}{4} = 1.75$ → интерполяция между 1-м и 2-м элементом: $1 + 0.75(2-1) = 1.75$.
- **Q2**: $\frac{3 + 4}{2} = 3.5$.
- **Q3**: $\frac{3(6+1)}{4} = 5.25$ → интерполяция между 5-м и 6-м элементом: $5 + 0.25(6-5) = 5.25$.

---

### **3. Практическое применение**
- **Ящиковая диаграмма (box plot):**  
  Границы "ящика" — Q1 и Q3, линия внутри — Q2. "Усы" показывают минимальное и максимальное значения (или выбросы).  
  Пример:  
  ![Box Plot](https://upload.wikimedia.org/wikipedia/commons/1/1a/Boxplot_vs_PDF.svg)

- **Анализ распределения:**  
  Если Q3 – Q1 (интерквартильный размах, IQR) мал, данные сконцентрированы вокруг медианы. Если велик — разброс большой.

---

### **4. Нюансы и предупреждения**
- **Разные методы расчета:**  
  В Excel, Python (библиотека `numpy`) или учебниках могут использоваться различные формулы. Например:
  - В Excel: `=QUARTILE.INC(data, 1)` для Q1.
  - В Python: `numpy.quantile(data, 0.25)`.
- **Четные vs нечетные наборы:**  
  Для четных наборов медиана — среднее двух центральных значений, что влияет на расчет Q1 и Q3.
- **Выбросы:**  
  Квартили устойчивы к выбросам, в отличие от среднего значения.

---

### **5. Примеры расчета**
#### **Пример A: Данные с выбросом**
Данные: `[2, 4, 6, 8, 10, 12, 14, 100]` ($n = 8$):
- Упорядоченные: `[2, 4, 6, 8, 10, 12, 14, 100]`.
- **Q1**: $\frac{8+1}{4} = 2.25$ → $4 + 0.25(6-4) = 4.5$.
- **Q2**: $\frac{8 + 10}{2} = 9$.
- **Q3**: $\frac{3(8+1)}{4} = 6.75$ → $12 + 0.75(14-12) = 13.5$.

#### **Пример B: Большой набор данных**
Данные: `[10, 20, 30, 40, 50, 60, 70, 80, 90, 100]` ($n = 10$):
- **Q1**: $\frac{10+1}{4} = 2.75$ → $20 + 0.75(30-20) = 27.5$.
- **Q2**: $\frac{50 + 60}{2} = 55$.
- **Q3**: $\frac{3(10+1)}{4} = 8.25$ → $80 + 0.75(90-80) = 87.5$.

---

### **Итог**
Квартили — это мощный инструмент для описания распределения данных. Они помогают:
- Найти медиану (Q2).
- Оценить разброс (через IQR = Q3 – Q1).
- Обнаружить выбросы (данные за пределами $Q1 - 1.5 \cdot IQR$ и $Q3 + 1.5 \cdot IQR$).

Для расчета всегда начинайте с упорядочивания данных и используйте интерполяцию, если позиция квартиля не целая.